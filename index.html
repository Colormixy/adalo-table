<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Курс и Таблица</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 12px;
      margin: 0;
      background: #fff;
      color: #111;
    }
    h1, h2 {
      text-align: center;
      margin: 8px 0;
    }
    .rate {
      font-weight: 700;
      font-size: 22px;
      color: #d32f2f;
      text-align: center;
      margin-bottom: 16px;
    }
    .news {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px 12px;
      margin: 12px 0;
      background: #fafafa;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f3f3f3;
      font-weight: bold;
    }
    .brands {
      text-align: center;
      margin-top: 20px;
    }
    .brands img {
      width: 100%;
      max-width: 375px;
      height: 267px;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <h1 id="date"></h1>
  <div class="rate" id="rate"></div>

  <div id="newsBox" style="display:none;">
    <h2>Новости</h2>
    <div class="news" id="news"></div>
  </div>

  <table id="dataTable"></table>

  <div class="brands" id="brandsBox" style="display:none;">
    <h2>Бонус начисляется за следующие бренды:</h2>
    <img id="brandsImg" src="" alt="Бренды">
  </div>

  <script>
    const TSV_URL = "https://colormixy.github.io/adalo-table/table.tsv"; // замени на свою ссылку
    const rateCell = { r: 1, c: 4 };    // E2
    const newsCell = { r: 1, c: 6 };    // G2
    const brandsCell = { r: 1, c: 8 };  // I2

    function formatDate() {
      const d = new Date();
      return d.toLocaleDateString("ru-RU", { day:"2-digit", month:"2-digit", year:"2-digit" });
    }

    async function loadTable() {
      const res = await fetch(TSV_URL + "?_cb=" + Date.now());
      const text = await res.text();
      const lines = text.trim().split(/\r?\n/).map(l => l.split("\t"));

      document.getElementById("date").textContent = "Курс на " + formatDate();

      // курс
      const rate = (lines[rateCell.r] || [])[rateCell.c] || "--";
      document.getElementById("rate").textContent = rate;

      // новости
      const news = (lines[newsCell.r] || [])[newsCell.c] || "";
      if (news) {
        document.getElementById("news").textContent = news;
        document.getElementById("newsBox").style.display = "block";
      }

      // таблица
      const table = document.getElementById("dataTable");
      table.innerHTML = "";
      lines.forEach((row, i) => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const el = document.createElement(i === 0 ? "th" : "td");
          el.textContent = cell;
          tr.appendChild(el);
        });
        table.appendChild(tr);
      });

      // бренды
      const brandsUrl = (lines[brandsCell.r] || [])[brandsCell.c] || "";
      if (brandsUrl.startsWith("http")) {
        document.getElementById("brandsImg").src = brandsUrl;
        document.getElementById("brandsBox").style.display = "block";
      }
    }

    loadTable();
    setInterval(loadTable, 20000);
  </script>
</body>
</html>
