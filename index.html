<!doctype html>
<html lang="ru">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Adalo Table (const)</title>
<style>
  :root { --pad: 10px; --border: 1px solid #ddd; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#fff; }
  .wrap { padding: var(--pad); }
  table { width:100%; border-collapse: collapse; table-layout: fixed; }
  th, td {
    border: var(--border);
    padding:8px;
    overflow:hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    text-align: center;     /* центрируем содержимое */
  }
  thead th {                /* заголовки с переносом */
    position: sticky; top:0; background:#fafafa;
    white-space: normal; word-break: break-word;
  }
  tbody tr:nth-child(odd){ background:#fcfcfc; }
</style>
<div class="wrap">
  <table id="t"><thead></thead><tbody></tbody></table>
</div>
<script>
/* === НАСТРОЙКИ — МЕНЯЙ ЗДЕСЬ === */
const TSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSEFIQibBd7WSJn-PrlsjJvKiTqAW3sUDxJO7s5Aq9woewpqaBBNIrTJvwyaijdJKSN9ULR4jP9I__w/pub?gid=0&single=true&output=tsv";
const ROWS = 27;         // ← сколько СТРОК показывать (включая первую строку, если она заголовок)
const COLS = 3;         // ← сколько СТОЛБЦОВ показывать
const USE_FIRST_ROW_AS_HEADER = true;  // true = первая строка — заголовки
const REFRESH_EVERY_MS = 20000;        // авто-обновление (мс)

/* Ломаем кэш Adalo/браузера (уникальный ?v=timestamp в URL страницы) */
(function () {
  const u = new URL(window.location.href);
  u.searchParams.set("v", Date.now().toString());
  window.history.replaceState({}, "", u.toString());
})();

async function fetchTSV() {
  const url = TSV_URL + (TSV_URL.includes("?") ? "&" : "?") + "_cb=" + Date.now();
  const res = await fetch(url, { cache: "no-store" });
  return (await res.text()).trim();
}

function render(text) {
  const rowsAll = text.split(/\r?\n/).filter(Boolean);
  const takeRows = Math.min(ROWS, rowsAll.length);
  const rows = rowsAll.slice(0, takeRows).map(r => r.split("\t").slice(0, COLS));

  const thead = document.querySelector("#t thead");
  const tbody = document.querySelector("#t tbody");
  thead.innerHTML = "";
  tbody.innerHTML = "";

  if (!rows.length) return;

  if (USE_FIRST_ROW_AS_HEADER) {
    const head = rows[0];
    const trHead = document.createElement("tr");
    head.forEach(c => {
      const th = document.createElement("th");
      th.textContent = c ?? "";
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);

    rows.slice(1).forEach(row => {
      const tr = document.createElement("tr");
      for (let i = 0; i < COLS; i++) {
        const td = document.createElement("td");
        td.textContent = row[i] ?? "";
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    });
  } else {
    rows.forEach(row => {
      const tr = document.createElement("tr");
      for (let i = 0; i < COLS; i++) {
        const td = document.createElement("td");
        td.textContent = row[i] ?? "";
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    });
  }
}

async function loadAndRender() {
  try { const t = await fetchTSV(); render(t); }
  catch (e) { console.error("TSV fetch error:", e); }
}

loadAndRender();
setInterval(loadAndRender, REFRESH_EVERY_MS);
document.addEventListener("visibilitychange", () => { if (!document.hidden) loadAndRender(); });
</script>
</html>
